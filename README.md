# lab6


## Найденные проблемы качества (code smells)

1. **Long method** — функция `process_checkout` содержала более 50 строк кода и выполняла слишком много задач: валидацию, расчёты, формирование результата.

2. **Magic numbers** — в коде использовались числа без пояснений: `0.10`, `0.20`, `0.21`, `200`, `100`, `50`, `10`. Непонятно, что они означают.

3. **Repeated code** — цикл по `items` повторялся дважды: для валидации и для подсчёта суммы.

4. **Poor readability** — логика расчёта скидок была вложенной и трудночитаемой.

5. **Hardcoded strings** — валюта по умолчанию "USD" была захардкодена в теле функции.

## Применённый рефакторинг

1. **Extract method** — логика разбита на отдельные функции:
   - `validate_request()` — валидация основных полей
   - `validate_items()` — валидация товаров
   - `calculate_subtotal()` — подсчёт суммы заказа
   - `calculate_discount()` — расчёт скидки по купону
   - `calculate_tax()` — расчёт налога
   - `generate_order_id()` — генерация ID заказа

2. **Extract constant** — все магические числа вынесены в константы с понятными именами:
   - `TAX_RATE = 0.21`
   - `COUPON_SAVE10_RATE = 0.10`
   - `COUPON_SAVE20_MIN_SUBTOTAL = 200`
   - и др.

3. **Replace loop with built-in** — цикл подсчёта суммы заменён на `sum()` с генератором.

4. **Simplify conditional** — вложенные условия в расчёте скидок упрощены с помощью раннего возврата.

5. **Use f-string** — конкатенация строк заменена на f-строку.

## Результат

После рефакторинга:
- Функция `process_checkout` сократилась с ~50 до ~15 строк
- Код понятно читается сверху вниз
- Каждая функция выполняет одну задачу (принцип single responsibility)
- Легко изменить налоговую ставку или условия купонов — достаточно поменять константу
- Все тесты проходят — поведение не изменилось
